const toKeyValRe=/((?:\[)[^\]]*(?:\])|(?:(?:(?:},\s*?[^=]{)|,|^)\s*?\w*=))/,structRe=/^{.*?(?:(?:(?:},\s*?{)|,|{|)\s*?(?:\w+)=).*?}$/,looseStructRe=/{.*?(?:(?:(?:},\s*?{)|,|{|)\s*?(?:\w+)=).*?}/,cleanKey=e=>{let t=/(\w+)=/.exec(e);return t[1]},isArray=e=>"["===e[0]&&"]"===e[e.length-1],isStruct=e=>structRe.test(e.trim()),isNumber=e=>!isNaN(e),parseValue=e=>{if("false"===e)return!1;if("true"===e)return!0;if("null"===e)return null;if(isNumber(e))return parseNumber(e);if(isArray(e))return parseArray(e).map(e=>parseValue(e));else if(isStruct(e))return parseStruct(e);return e},ObjectStates={KEY:"key",VALUE:"value"},parseStruct=e=>{let t=e.trim();e=t.substr(1).substr(0,e.length-2).trim();let[,...r]=e.split(toKeyValRe),s={},u={type:ObjectStates.KEY};for(var a=0;a<r.length;a++){let l=r[a];if(""!==l.trim()&&(u.type!==ObjectStates.KEY||""!==l||!r[a-1]||"["!==r[a-1][0])){if(u.type===ObjectStates.KEY){u.key=cleanKey(l),u.type=ObjectStates.VALUE;continue}if((u.type!==ObjectStates.VALUE||""!==l||!r[a+1]||"["!==r[a+1][0])&&u.type===ObjectStates.VALUE){let{key:i}=u;delete u.key,s[i]=parseValue(l),u.type=ObjectStates.KEY;continue}}}return s},splitByBoundingChars=(e,t,r)=>{let s=[],u=0,a="";for(let l=0;l<e.length;l++){let i=e[l];if(0!==u&&(a=`${a}${i}`),i===t){u+=1,a=t;continue}0!==u&&(i===r&&(u-=1),0===u&&(s.push(a),a=""))}return s},parseArray=e=>{let t=e.trim().substr(1).substr(0,e.length-2);return looseStructRe.test(t)?splitByBoundingChars(t,"{","}"):isArray(t)?splitByBoundingChars(t,"[","]"):t.split(/,\s*/)},parseNumber=e=>parseInt(e,10);module.exports=parseValue,module.exports.default=parseValue;
